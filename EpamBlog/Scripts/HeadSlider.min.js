function Point3D(n,t,i){this.x=n;this.y=t;this.z=i;this.rotateX=function(n){var t,i,r,u,f;return t=n*Math.PI/180,i=Math.cos(t),r=Math.sin(t),u=this.y*i-this.z*r,f=this.y*r+this.z*i,new Point3D(this.x,u,f)};this.rotateY=function(n){var t,i,r,u,f;return t=n*Math.PI/180,i=Math.cos(t),r=Math.sin(t),f=this.z*i-this.x*r,u=this.z*r+this.x*i,new Point3D(u,this.y,f)};this.rotateZ=function(n){var t,i,r,u,f;return t=n*Math.PI/180,i=Math.cos(t),r=Math.sin(t),u=this.x*i-this.y*r,f=this.x*r+this.y*i,new Point3D(u,f,this.z)};this.projection=function(n,t,i,r){var u,f,e;return u=i/(r+this.z),f=this.x*u+n/2,e=this.y*u+t/2,new Point3D(f,e,this.z)}}function drawScene(){var i,s,h,f,r,c,l,o;for(ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),i=[],s=0;s<vertices.length;s++){var b=vertices[s],k=b.rotateY(angle),d=k.projection(ctx.canvas.width,ctx.canvas.height,450,3);i.push(d)}for(h=[],f=0;f<faces.length;f++)r=faces[f],h[f]={ind:f,z:(i[r[0]].z+i[r[1]].z+i[r[2]].z+i[r[3]].z)/4};for(f=0;f<faces.length;f++)if(r=faces[h[f].ind],i[r[3]].z+i[r[2]].z+i[r[1]].z+i[r[0]].z>-3&&(ctx.save(),ctx.fillStyle="rgb(160,180,160)",ctx.beginPath(),ctx.moveTo(i[r[0]].x,i[r[0]].y),ctx.lineTo(i[r[1]].x,i[r[1]].y),ctx.lineTo(i[r[2]].x,i[r[2]].y),ctx.lineTo(i[r[3]].x,i[r[3]].y),ctx.closePath(),ctx.fill(),f<4)){for(c=points.length;--c>-1;){var e=points[c],p=i[r[0]].x+e.ny*(i[r[3]].x-i[r[0]].x),w=i[r[0]].y+e.ny*(i[r[3]].y-i[r[0]].y);e.px=p+e.nx*(i[r[1]].x+e.ny*(i[r[2]].x-i[r[1]].x)-p)+e.ox;e.py=w+e.nx*(i[r[1]].y+e.ny*(i[r[2]].y-i[r[1]].y)-w)+e.oy}for(l=triangles.length;--l>-1;){var a=triangles[l],u=a.p0,n=a.p1,t=a.p2,v=(u.px+n.px+t.px)/3,y=(u.py+n.py+t.py)/3;ctx.save();ctx.beginPath();ctx.moveTo(1.05*u.px-v*.05,1.05*u.py-y*.05);ctx.lineTo(1.05*n.px-v*.05,1.05*n.py-y*.05);ctx.lineTo(1.05*t.px-v*.05,1.05*t.py-y*.05);ctx.closePath();ctx.clip();o=u.tx*(t.ty-n.ty)-n.tx*t.ty+t.tx*n.ty+(n.tx-t.tx)*u.ty;ctx.transform(-(u.ty*(t.px-n.px)-n.ty*t.px+t.ty*n.px+(n.ty-t.ty)*u.px)/o,(n.ty*t.py+u.ty*(n.py-t.py)-t.ty*n.py+(t.ty-n.ty)*u.py)/o,(u.tx*(t.px-n.px)-n.tx*t.px+t.tx*n.px+(n.tx-t.tx)*u.px)/o,-(n.tx*t.py+u.tx*(n.py-t.py)-t.tx*n.py+(t.tx-n.tx)*u.py)/o,(u.tx*(t.ty*n.px-n.ty*t.px)+u.ty*(n.tx*t.px-t.tx*n.px)+(t.tx*n.ty-n.tx*t.ty)*u.px)/o,(u.tx*(t.ty*n.py-n.ty*t.py)+u.ty*(n.tx*t.py-t.tx*n.py)+(t.tx*n.ty-n.tx*t.ty)*u.py)/o);ctx.drawImage(aImages[f],0,0);ctx.restore()}}angle+=.3;setTimeout(drawScene,40)}for(var oImg,canvas,ctx,aImages=[],points=[],triangles=[],textureWidth,textureHeight,lev=3,angle=0,vertices=[new Point3D(-2,-1,2),new Point3D(2,-1,2),new Point3D(2,1,2),new Point3D(-2,1,2),new Point3D(-2,-1,-2),new Point3D(2,-1,-2),new Point3D(2,1,-2),new Point3D(-2,1,-2)],faces=[[0,1,2,3],[1,5,6,2],[5,4,7,6],[4,0,3,7],[0,4,5,1],[3,2,6,7]],aImgs=["/Content/Images/1.jpg","/Content/Images/2.jpg","/Content/Images/3.png","/Content/Images/4.jpg"],i=0;i<aImgs.length;i++)oImg=new Image,oImg.src=aImgs[i],aImages.push(oImg),oImg.onload=function(){textureWidth=oImg.width;textureHeight=oImg.height};window.addEventListener("load",function(){var r,u,i,n,t;for(canvas=document.getElementById("slideshow"),ctx=canvas.getContext("2d"),n=0;n<=lev;n++)for(t=0;t<=lev;t++)r=n*(textureWidth/lev),u=t*(textureHeight/lev),points.push({tx:r,ty:u,nx:r/textureWidth,ny:u/textureHeight,ox:n,oy:t});for(i=lev+1,n=0;n<lev;n++)for(t=0;t<lev;t++)triangles.push({p0:points[t+n*i],p1:points[t+n*i+1],p2:points[t+(n+1)*i],up:!0}),triangles.push({p0:points[t+(n+1)*i+1],p1:points[t+(n+1)*i],p2:points[t+n*i+1],up:!1});drawScene()});